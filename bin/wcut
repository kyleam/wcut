#!/usr/bin/env python3
#; -*- mode: Python;-*-

import wcut
from wcut.deps.docopt import docopt
from wcut.deps.stdcheck import stdout_check


def process_commandline(args):
    delim = args['--delimiter']
    ## strip quotes
    if delim.startswith('"') and delim.endswith('"'):
        delim = delim[1:-1]
    elif delim.startswith("'") and delim.endswith("'"):
        delim = delim[1:-1]
    ## this will work in both python 2 and 3
    delim = delim.encode('utf-8').decode('unicode-escape')
    args['--delimiter'] = delim

    args['WORDS'] = args['WORDS'].split(',')
    args['--line'] = int(args['--line'])
    return(args)

if __name__ == '__main__':
    args = process_commandline(docopt(wcut._script_doc))
    with stdout_check(args['-o'], source=wcut.__version__) as ofh:
        delim = args['--delimiter']
        lines = wcut.get_lines(args['FILE'])
        fields = wcut.process_lines(lines, args['--line'], args['WORDS'], delim,
                                    wholename=args['--wholename'],
                                    ignore_case=args['--ignore-case'])
        wcut.write_fields(ofh, fields, delim)
