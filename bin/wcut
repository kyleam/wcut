#!/usr/bin/env python3
#; -*- mode: Python;-*-

from docopt import docopt

import wcut
from wcut import io, cli


if __name__ == '__main__':
    args = docopt(wcut.cli.__doc__, version=wcut.__version__)
    cli.process_commandline(args)
    delim = args['--delimiter']
    match_lineno = args['--line']

    lines = io.get_lines(args['FILE'])

    if args['--remove-preheader']:
        lines = wcut.suppress_preheader_lines(lines, match_lineno)
    if args['--only-delimited']:
        lines = wcut.suppress_no_delim_lines(lines, delim)

    fields = wcut.extract_fields(lines, delim, args['WORDS'],
                                 match_lineno=match_lineno,
                                 wholename=args['--wholename'],
                                 ignore_case=args['--ignore-case'],
                                 complement=args['--complement'])

    with io.stdout_check(args['-o']) as ofh:
        io.write_fields(ofh, fields, delim)
